# TTSmate V1 系统需求说明书

## 1. 引言

### 1.1 编写目的
本文档旨在详细说明 TTSmate V1 智能语音合成客户端的系统需求。其主要目标是为开发、测试和最终用户提供一份清晰、准确的功能和性能参照。

### 1.2 背景
- **软件名称**: TTSmate V1 - AI 驱动的文本转语音工具
- **项目背景**: 满足用户将任意文本主题快速转换为自然语音的需求，特别适用于需要生成短文本并进行语音播报的场景。
- **开发者**: 个人开发者
- **用户**: 需要快速将文本思路转换为语音的个人用户。

### 1.3 定义
- **TTS**: Text-to-Speech，文本转语音技术。
- **DeepSeek API**: 一种提供强大文本生成功能的人工智能服务。
- **Baidu TTS API**: 百度提供的文本转语音云服务。
- **GUI**: 图形用户界面。
- **Sink**: 在 `rodio` 音频库中，一个 Sink 代表一个音频播放通道，用于消费和播放音频源。

## 2. 任务概述

### 2.1 目标
TTSmate V1 旨在打造一个轻量级、响应迅速且高度可配置的桌面应用程序。其核心流程是：
1. 用户输入一个主题，或直接输入完整的待播报文本。
2. （可选）应用根据用户选择的 AI 提示词模板（如"标准助手"、"游戏旁白"等），调用 **DeepSeek API** 智能生成一段文本。此步骤可被跳过。
3. 应用将最终文本（AI 生成的或用户直接输入的）发送到 **Baidu TTS API**，将其合成为高质量的 MP3 音频。
4. 应用将接收到的音频数据在用户的默认音频设备上播放。同时，用户可以随时点击音效板按钮播放短音效。

该工具为用户提供了一个灵活的"创意/文本 -> 语音"转换体验。

### 2.2 用户特点
- **目标用户**: 熟悉基本电脑操作，有文本转语音需求的个人用户，包括内容创作者、游戏玩家等。
- **技术水平**: 初级到中级，能够按照说明配置 `config.toml` 文件中的 API 密钥和自定义模板。
- **使用场景**:
    - 快速验证文本的语音效果。
    - 为视频或其他媒体内容生成旁白草稿。
    - 在游戏或直播中通过音效板播放音效。
    - 在不方便打字或说话的场合，通过文本生成语音进行交流。

## 3. 功能与性能需求

### 3.1 核心功能
1.  **灵活的文本源**:
    -   提供一个复选框，允许用户选择是否启用"使用 DeepSeek 生成文案"功能。
    -   若启用，应用将用户输入视为"主题"，并调用 AI 生成文本。
    -   若禁用，应用将用户输入视为"最终文本"，直接用于语音合成。
2.  **可配置的 AI 行为**:
    -   提供一个下拉菜单，允许用户从 `config.toml` 中定义的多个提示词模板中选择一个。
    -   支持"自定义模板"选项，允许用户在 UI 中临时编写和使用自己的系统提示词。
3.  **云端语音合成**:
    -   集成百度 TTS 云服务 API。
    -   提供 UI 控件，允许用户实时调整语音合成的参数，包括：发音人、语速、音调和音量。
4.  **音效板 (Soundboard)**:
    -   在 UI 上根据 `config.toml` 的配置动态生成一组按钮。
    -   点击按钮可立即播放预设的音效文件（如 MP3, WAV）。
5.  **双通道音频播放**:
    -   内置基于 `rodio` 的音频播放器。
    -   使用两个独立的播放通道（Sink）：一个专门用于播放 TTS 语音，另一个专门用于播放音效。
    -   此设计允许音效在 TTS 语音播放的同时播放，实现简单的音频叠加效果。
6.  **状态显示**:
    -   在界面上提供清晰的状态反馈，例如："就绪"、"正在生成文本..."、"正在合成语音..."等。
7.  **全面的配置管理**:
    -   通过本地 `config.toml` 文件管理所有可配置项。
    -   包括：API 密钥、应用默认参数（语速、音量等）、AI 提示词模板列表、音效板的名称和文件路径。

### 3.2 用户界面 (UI)
-   使用 `egui` 框架构建，确保跨平台兼容性和轻量化。
-   界面布局包含多个可折叠区域，用于"AI 设置"、"语音参数"和"音效板"，保持主窗口的整洁。
-   为支持中文显示，程序会尝试加载 Windows 系统自带的中文字体。

### 3.3 性能要求
-   **响应时间**: 从点击按钮到开始播放语音，整个过程应在数秒内完成（具体时间取决于网络延迟）。音效播放应接近瞬时响应。
-   **资源占用**: 作为桌面工具，应控制内存和 CPU 使用率在合理范围。

## 4. 运行环境与依赖

### 4.1 硬件与系统
-   **操作系统**: Windows (经测试)。理论上可扩展至 macOS 和 Linux。
-   **硬件要求**: 基础 PC 硬件，需要有可用的音频输出设备。
-   **网络**: 必须连接到互联网，以便访问 DeepSeek 和 Baidu 的云服务。

### 4.2 外部依赖
-   **DeepSeek API Key**: 用户必须自行申请并配置。
-   **Baidu API Key & Secret Key**: 用户必须自行申请并配置。

### 4.3 接口
-   **外部接口**:
    -   `https://api.deepseek.com/chat/completions`: 用于文本生成。
    -   `https://aip.baidubce.com/oauth/2.0/token`: 用于获取百度 API 访问令牌。
    -   `https://tsn.baidu.com/text2audio`: 用于合成语音。
-   **内部接口**:
    -   使用 `rodio` 库与操作系统音频后端交互及解码音频数据。

## 5. 尚需解决的问题
- **跨平台兼容性**: 虽然理论上支持，但未经在 macOS 和 Linux 上的完整测试。
- **错误处理**: 当前的错误处理主要是在状态栏显示文本，可以进一步优化，提供更详细的错误日志或用户指引。
- **音频播放限制**: 当前的音频系统不支持同时播放多个音效（新的会覆盖旧的）。
- **配置持久化**: UI 上的设置（如选择的模板、滑块值）在程序关闭后不会被保存。
